// import React from 'react';

// export const categories = [
//   {
//     title: 'ABAYA',
//     description: 'Check out our newest Abayas',
//     products: [
//       {
//         title: 'WINE AND PEACH MIDI DRESS',
//         price: '₦40,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'EMERALD GREEN MAXI DRESS',
//         price: '₦45,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'BLACK AND GOLD ABAYA',
//         price: '₦50,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'ROYAL BLUE ELEGANT SET',
//         price: '₦42,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'GOWN',
//     description: 'Explore our elegant gowns',
//     products: [
//       {
//         title: 'LUXURIOUS SILK GOWN',
//         price: '₦55,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'EVENING BLACK GOWN',
//         price: '₦60,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'RED CORSET GOWN',
//         price: '₦48,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'WHITE LACE GOWN',
//         price: '₦50,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'JALABIYA',
//     description: 'Traditional meets modern Jalabiyas',
//     products: [
//       {
//         title: 'NAVY EMBROIDERED JALABIYA',
//         price: '₦38,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'WHITE ROYAL JALABIYA',
//         price: '₦40,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'CLASSIC GREY JALABIYA',
//         price: '₦35,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'BLACK & GOLD JALABIYA',
//         price: '₦47,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'SHOES',
//     description: 'Step out in style with our latest shoes',
//     products: [
//       {
//         title: 'BLACK HEEL SANDALS',
//         price: '₦28,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'BROWN LEATHER SLIPPERS',
//         price: '₦25,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'WHITE PLATFORM SNEAKERS',
//         price: '₦30,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'GOLDEN STILETTO HEELS',
//         price: '₦35,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'BAGS',
//     description: 'Chic and functional bags for every outing',
//     products: [
//       {
//         title: 'BLACK SHOULDER BAG',
//         price: '₦22,000.00',
//        image: '/image/abaya.jpg',
//       },
//       {
//         title: 'TAN LEATHER TOTE',
//         price: '₦27,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'WHITE MINI HANDBAG',
//         price: '₦20,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'LUXURY DESIGNER BAG',
//         price: '₦80,000.00',
//        image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'CAPS',
//     description: 'Finish your look with a stylish cap',
//     products: [
//       {
//         title: 'BLACK COTTON CAP',
//         price: '₦8,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'WHITE BASEBALL CAP',
//         price: '₦9,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'BEIGE BUCKET HAT',
//         price: '₦10,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'DENIM SNAPBACK',
//         price: '₦11,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'SCARVES',
//     description: 'Wrap up in elegance with our scarf collection',
//     products: [
//       {
//         title: 'SILK FLORAL SCARF',
//         price: '₦15,000.00',
//        image: '/image/abaya.jpg',
//       },
//       {
//         title: 'PLAIN WOOL SCARF',
//         price: '₦12,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'TWO-TONE HEADWRAP',
//         price: '₦10,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'SATIN PRINT SCARF',
//         price: '₦14,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'HIJABS',
//     description: 'Elegant hijabs in various colors and fabrics',
//     products: [
//       {
//         title: 'BLACK GEORGETTE HIJAB',
//         price: '₦9,000.00',
//        image: '/image/abaya.jpg',
//       },
//       {
//         title: 'NUDE SILK HIJAB',
//         price: '₦11,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'PINK CHIFFON HIJAB',
//         price: '₦10,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'MINT CREPE HIJAB',
//         price: '₦12,000.00',
//         image: '/image/abaya.jpg',
//       },
//     ],
//   },
//   {
//     title: 'UNDERWEAR',
//     description: 'Soft, breathable and invisible undergarments',
//     products: [
//       {
//         title: 'SEAMLESS BRALETTE SET',
//         price: '₦15,000.00',
//        image: '/image/abaya.jpg',
//       },
//       {
//         title: 'NUDE SLIP SHORTS',
//         price: '₦7,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'COTTON LACE BRA',
//         price: '₦10,000.00',
//         image: '/image/abaya.jpg',
//       },
//       {
//         title: 'INVISIBLE PANTY PACK (3)',
//         price: '₦9,500.00',
//        image: '/image/abaya.jpg',
//       },
//     ],
//   },
// ];

// function Products() {
//   return (
//     <div className="w-full flex flex-col justify-center items-center">
//       {categories.map((category, catIndex) => {
//         const bgColor = catIndex % 2 === 0 ? 'bg-white' : 'bg-[#F1E8DF]';

//         return (
//           <div key={catIndex} className={`w-full ${bgColor} flex justify-center`}>
//             <div className="w-[70%] flex items-center justify-center py-[70px] flex-col gap-[40px]">
//               {/* Title */}
//               <div className="flex flex-col justify-center items-center gap-[15px]">
//                 <p className="text-[40px]">{category.title}</p>
//                 <p className="text-[18px] text-[#686868] font-semibold">{category.description}</p>
//               </div>

//               {/* Product Grid */}
//               <div className="w-full flex justify-between items-center flex-wrap gap-y-10">
//                 {category.products.map((product, index) => (
//                   <div key={index} className="w-[23%] flex flex-col gap-[7px]">
//                     <div className="w-full h-[400px] bg-gray-500 overflow-hidden rounded-md">
//                       <img
//                         src={product.image}
//                         alt={product.title}
//                         className="w-full h-full object-cover"
//                       />
//                     </div>
//                     <div className="w-full flex-col gap-[7px] flex">
//                       <p className="text-[18px] font-semibold text-[#686868]">{product.title}</p>
//                       <p className="text-[30px]">{product.price}</p>
//                     </div>
//                     <button className="w-[80%] border-2 border-black py-[15px] rounded-[10px] mt-[10px] text-[18px] font-bold cursor-pointer hover:bg-black hover:text-white">
//                       Contact Now
//                     </button>
//                   </div>
//                 ))}
//               </div>
//             </div>
//           </div>
//         );
//       })}
//     </div>
//   );
// }

// export default Products;




// import React, { useState, useEffect } from 'react';

// const categoryMeta = {
//   all:      { title: 'ALL PRODUCTS',       description: 'Browse our full collection' },
//   abaya:    { title: 'ABAYA',              description: 'Check out our newest Abayas' },
//   gown:     { title: 'GOWN',               description: 'Explore our elegant gowns' },
//   jalabiya: { title: 'JALABIYA',           description: 'Traditional meets modern Jalabiyas' },
//   shoe:    { title: 'SHOES',              description: 'Step out in style with our latest shoes' },
//   bag:     { title: 'BAGS',               description: 'Chic and functional bags for every outing' },
//   cap:     { title: 'CAPS',               description: 'Finish your look with a stylish cap' },
//   scarve:  { title: 'SCARVES',            description: 'Wrap up in elegance with our scarf collection' },
//   hijab:   { title: 'HIJABS',             description: 'Elegant hijabs in various colors and fabrics' },
//   underwear:{ title: 'UNDERWEAR',          description: 'Soft, breathable and invisible undergarments' },
// };

// function Products() {
//   const [categories, setCategories] = useState(null);
//   const [error, setError]         = useState(null);

//   useEffect(() => {
//     const keys = Object.keys(categoryMeta);

//     Promise.all(
//       keys.map(key =>
//         fetch(`http://localhost:1040/products/category/${key}`)
//           .then(res => {
//             if (!res.ok) throw new Error(`Failed to load ${key}: ${res.status}`);
//             return res.json();
//           })
//           .then(({ products }) => ({
//             title:       categoryMeta[key].title,
//             description: categoryMeta[key].description,
//             products: products.map(p => ({
//               title: p.productName.trim(),
//               price: `₦${Number(p.price).toLocaleString()}`,
//               image: p.productImage,
//             })),
//           }))
//       )
//     )
//       .then(catArray => setCategories(catArray))
//       .catch(err => setError(err.message));
//   }, []);

//   if (error) {
//     return (
//       <div className="w-full flex justify-center py-20">
//         <p className="text-red-600">Error loading products: {error}</p>
//       </div>
//     );
//   }

//   if (!categories) {
//     return (
//       <div className="w-full flex justify-center py-20">
//         <p>Loading products…</p>
//       </div>
//     );
//   }

//   return (
//     <div className="w-full flex flex-col justify-center items-center">
//       {categories.map((category, i) => {
//         const bgColor = i % 2 === 0 ? 'bg-white' : 'bg-[#F1E8DF]';
//         return (
//           <div key={category.title} className={`w-full ${bgColor} flex justify-center`}>
//             <div className="w-[70%] py-[70px] flex flex-col items-center gap-[40px]">
//               <div className="flex flex-col items-center gap-[15px]">
//                 <p className="text-[40px]">{category.title}</p>
//                 <p className="text-[18px] text-[#686868] font-semibold">
//                   {category.description}
//                 </p>
//               </div>

//               <div className="w-full flex flex-wrap justify-between gap-y-10">
//                 {category.products.map((product, idx) => (
//                   <div key={idx} className="w-[23%] flex flex-col gap-[7px]">
//                     <div className="w-full h-[400px] bg-gray-500 overflow-hidden rounded-md">
//                       <img
//                         src={product.image}
//                         alt={product.title}
//                         className="w-full h-full object-cover"
//                       />
//                     </div>
//                     <div className="flex flex-col gap-[7px]">
//                       <p className="text-[18px] font-semibold text-[#686868]">
//                         {product.title}
//                       </p>
//                       <p className="text-[30px]">{product.price}</p>
//                     </div>
//                     <button className="w-[80%] border-2 border-black py-[15px] rounded-[10px] mt-[10px] text-[18px] font-bold cursor-pointer hover:bg-black hover:text-white">
//                       Contact Now
//                     </button>
//                   </div>
//                 ))}
//               </div>
//             </div>
//           </div>
//         );
//       })}
//     </div>
//   );
// }

// export default Products;

import React, { useMemo } from 'react';
import { useProducts } from '../../hooks/useProducts';
import CategorySection from './CategorySection';
// import CategorySection from './CategorySection';  

const categoryMeta = {
  all:       { title: 'ALL PRODUCTS',  description: 'Browse our full collection' },
  abaya:     { title: 'ABAYA',         description: 'Check out our newest Abayas' },
  gown:      { title: 'GOWN',          description: 'Explore our elegant gowns' },
  jalabiya:  { title: 'JALABIYA',      description: 'Traditional meets modern Jalabijas' },
  shoe:      { title: 'SHOES',         description: 'Step out in style with our latest shoes' },
  bag:       { title: 'BAGS',          description: 'Chic and functional bags for every outing' },
  cap:       { title: 'CAPS',          description: 'Finish your look with a stylish cap' },
  scarve:    { title: 'SCARVES',       description: 'Wrap up in elegance with our scarf collection' },
  hijab:     { title: 'HIJABS',        description: 'Elegant hijabs in various colors and fabrics' },
  underwear: { title: 'UNDERWEAR',     description: 'Soft, breathable and invisible undergarments' },
};

function Products() {
  // 1. Always call hooks at the top level, in the same order
  const { grouped, error } = useProducts();

  const cleanPrice = (value) => {
    if (typeof value === 'number') return value;
    if (typeof value === 'string') {
      const sanitized = value.replace(/[^0-9.]/g, ''); // remove ₦, commas, spaces
      return Number(sanitized) || 0;
    }
    return 0;
  };

  // 2. Always call useMemo (or any hook) unconditionally
  const sections = useMemo(() => {
    if (!grouped) return [];
    return Object.entries(grouped).map(([key, prods]) => ({
      key,
      title:       categoryMeta[key]?.title       || key.toUpperCase(),
      description: categoryMeta[key]?.description || '',
      // FIX: use `prods`, not `products`
      products: prods.map(p => ({
        title: p.productName.trim(),
        // price: `₦${Number(p.price).toLocaleString()}`,
        price: `₦${cleanPrice(p.price).toLocaleString()}`,
        image: p.productImage,
      })),
    }));
  }, [grouped]);

  // 3. Early returns only affect rendering, not hook order
  if (error)   return <p className="text-red-600">Error: {error}</p>;
  if (!grouped) return <p>Loading…</p>;

  // 4. Now render your sections
  return (
    <div className="w-full flex flex-col items-center">
      {sections.map((sec, i) => (
        <CategorySection
          key={sec.key}
          category={sec}
          index={i}
        />
      ))}
    </div>
  );
}

export default Products;
